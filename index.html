<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<title>Family Feud School Studio</title>
<link rel="stylesheet" href="style.css">
<style>
  .qa-overlay {
    position: fixed;
    inset: 0;
    display: grid;
    place-items: center;
    overflow: hidden;
    z-index: 5000;
    background:
      radial-gradient(1200px 600px at 50% 30%, #0b1b3a 0%, #050913 45%, #02040a 100%);
  }
  .qa-overlay.hidden { display: none; }
  .qa-stage { position: relative; width: 100vw; height: 100vh; display: grid; place-items: center; perspective: 1600px; perspective-origin: 50% 50%; }
  .qa-board-wrap { --board-w: min(1040px, 92vw); --board-h: calc(var(--board-w) * 0.56); --thickness: 28px; width: var(--board-w); height: var(--board-h); position: absolute; transform-style: preserve-3d; will-change: transform; }
  .qa-board-wrap.run { animation: qaFlySpin 4s cubic-bezier(0.22, 0.7, 0.2, 1) forwards; }
  .qa-board { position: relative; width: 100%; height: 100%; transform-style: preserve-3d; border-radius: 50% / 45%; filter: drop-shadow(0 28px 40px rgba(0, 0, 0, 0.55)); }
  .qa-face { position: absolute; inset: 0; border-radius: 50% / 45%; overflow: hidden; backface-visibility: hidden; -webkit-backface-visibility: hidden; border: 8px solid #d9b46f; box-shadow: inset 0 0 40px rgba(108, 181, 255, 0.25), inset 0 0 0 5px rgba(27, 79, 171, 0.25); background: #091733; }
  .qa-face img { width: 100%; height: 100%; object-fit: cover; display: block; }
  .qa-front { transform: translateZ(calc(var(--thickness) / 2)); }
  .qa-back  { transform: rotateY(180deg) translateZ(calc(var(--thickness) / 2)); }

  .qa-edge { position: absolute; inset: 4% 1.3%; border-radius: 50% / 45%; background: linear-gradient(90deg, #8e6a35 0%, #e5c07a 50%, #8e6a35 100%); transform: translateZ(0); box-shadow: 0 0 16px rgba(255, 213, 133, 0.35); z-index: -1; }
  .qa-next-question { position: absolute; opacity: 0; transform: translateY(18px) scale(0.98); transition: opacity 0.5s ease, transform 0.5s ease; text-align: center; font-size: clamp(24px, 4vw, 48px); letter-spacing: 0.5px; text-shadow: 0 4px 18px rgba(0, 0, 0, 0.5); color: #f5f7ff; font-family: Arial, sans-serif; }
  .qa-next-question.show { opacity: 1; transform: translateY(0) scale(1); }
  .qa-stage-message {
    position: absolute;
    inset: 0;
    display: grid;
    place-items: center;
    text-align: center;
    padding: 24px;
    font-family: Arial, sans-serif;
    font-size: clamp(34px, 6vw, 92px);
    font-weight: 800;
    letter-spacing: 1px;
    color: #f8fbff;
    text-shadow: 0 8px 26px rgba(0, 0, 0, 0.72);
    opacity: 0;
    transition: opacity 0.35s ease;
    z-index: 8;
  }
  .qa-stage-message.show { opacity: 1; }
  .qa-stage-message.hidden { display: none; }
    .qa-continue-btn {
      position: absolute;
      bottom: 7vh;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9;
      padding: 14px 34px;
      font-size: clamp(18px, 2.3vw, 28px);
      font-weight: 800;
      border: 0;
      border-radius: 14px;
      color: #0e1f45;
      background: linear-gradient(180deg, #fff0be, #ffc95f);
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.45);
      cursor: pointer;
    }
    .qa-continue-btn.hidden { display: none; }
  .qa-board-wrap.run .qa-front img {
    animation: qaCounterFront 4s cubic-bezier(0.22, 0.7, 0.2, 1) forwards;
  }

  .qa-board-wrap.run .qa-back img {
    animation: qaCounterBack 4s cubic-bezier(0.22, 0.7, 0.2, 1) forwards;
  }

  @keyframes qaCounterFront {
    0% { transform: rotateY(0deg); }
    37.5% { transform: rotateY(-180deg); }
    62.5% { transform: rotateY(-180deg); }
    100% { transform: rotateY(-360deg); }
  }

  @keyframes qaCounterBack {
    0% { transform: rotateY(-180deg); }
    37.5% { transform: rotateY(-360deg); }
    62.5% { transform: rotateY(-360deg); }
    100% { transform: rotateY(-540deg); }
  }
  @keyframes qaFlySpin {
    0% { transform: translateX(-140vw) rotateY(0deg) rotateZ(0deg); }
    37.5% { transform: translateX(0) rotateY(180deg) rotateZ(0deg); }
    62.5% { transform: translateX(0) rotateY(180deg) rotateZ(0deg); }
    100% { transform: translateX(140vw) rotateY(360deg) rotateZ(0deg); }
  }
</style>
</head>
<body>

<div class="qa-overlay hidden" id="quizAnimationOverlay" aria-hidden="true">
  <div class="qa-stage">
    <div class="qa-board-wrap" id="qaBoardWrap">
      <div class="qa-board">
        <div class="qa-edge"></div>
        <div class="qa-face qa-front">
          <img id="qaFrontImage" src="pictures/1.png" alt="Broj strana" />
        </div>
        <div class="qa-face qa-back">
          <img id="qaBackImage" src="pictures/1.png" alt="Broj strana" />
        </div>
      </div>
    </div>
    <div class="qa-stage-message hidden" id="qaStageMessage"></div>
    <button class="qa-continue-btn hidden" id="qaContinueBtn" type="button">NASTAVI</button>
  </div>
</div>

<div id="startScreen" class="start-screen">
  <div class="start-card">
    <img
      class="start-logo"
      src="pictures/logo.png"
      alt="Family Feud"
    >
    <div class="start-actions">
      <button class="start-btn" onclick="startGameFromIntro()">Igraj</button>
      <button class="start-btn start-btn-secondary" onclick="openQuestionEditor()">Uredi pitanja</button>
      <button class="start-btn start-btn-secondary" onclick="openProjection()">Projeciraj</button>
    </div>
</div>
</div>

<div id="gameRoot" class="studio hidden">
  <div class="game-stage">
    <div id="team1" class="team side-score left active">TIM 1 <span>0</span></div>

    <div class="main-oval">
      <div class="top-total"><span id="roundTotal">0</span></div>

      <div class="question-panel">
        <div id="question">Dobrodosli!</div>
      </div>

      <div class="board-shell">
        <div class="board" id="board"></div>
      </div>

      <div class="strike-zone">
        <div id="strikes"></div>
      </div>
    </div>

    <div id="team2" class="team side-score right">TIM 2 <span>0</span></div>
  </div>

  <div class="control-panel">
    <div class="control-nav">
      <button class="menu-toggle" id="controlMenuToggle" aria-label="Otvori meni" onclick="toggleControlMenu()">&#9776;</button>
      <div class="control-menu hidden" id="controlMenu">
        <button class="control-menu-item" onclick="goToStartScreen()">Pocetna stranica</button>
      </div>
    </div>
    <div class="buttons">
      <button onclick="revealAnswer(0)">Odgovor 1</button>
      <button onclick="revealAnswer(1)">Odgovor 2</button>
      <button onclick="revealAnswer(2)">Odgovor 3</button>
      <button onclick="revealAnswer(3)">Odgovor 4</button>
      <button onclick="revealAnswer(4)">Odgovor 5</button>
      <button onclick="revealAnswer(5)">Odgovor 6</button>
      <button onclick="revealAnswer(6)">Odgovor 7</button>
      <button onclick="revealAnswer(7)">Odgovor 8</button>
    </div>
    <div class="buttons">
      <button onclick="addStrike()">X</button>
      <button onclick="steal()">STEAL</button>
      <button onclick="endRound()">END ROUND</button>
      <button onclick="switchTeam()">SWITCH TEAM</button>
      <button onclick="openProjection()">PROJECIRAJ</button>
    </div>
    <div class="buttons hidden" id="estimationControls">
      <button onclick="chooseAdvantageTeam(0)">PREDNOST TIM 1</button>
      <button onclick="chooseAdvantageTeam(1)">PREDNOST TIM 2</button>
    </div>
    <div class="buttons hidden" id="stageContinueControls">
      <button onclick="continueToNextStage()">NASTAVI</button>
    </div>
  </div>
</div>

<div id="questionEditorModal" class="editor-modal hidden" aria-hidden="true">
  <div class="editor-backdrop" onclick="closeQuestionEditor()"></div>
  <div class="editor-dialog" role="dialog" aria-modal="true" aria-labelledby="editorTitle">
    <h2 id="editorTitle">Uredi pitanja</h2>
    <p class="editor-help">Uredi pitanja kroz polja ispod.</p>
    <label class="editor-label" for="questionEditorStage">Igra</label>
    <select id="questionEditorStage" class="editor-stage" onchange="onQuestionEditorStageChange(this.value)">
      <option value="1">Game One</option>
      <option value="2">Game Two</option>
      <option value="3">Finale</option>
    </select>
    <div id="questionEditorForm" class="editor-form"></div>
    <div class="editor-actions">
      <button onclick="saveQuestionEditor()">Sacuvaj</button>
      <button onclick="closeQuestionEditor()">Otka?i</button>
    </div>
  </div>
</div>
<script>
  (function () {
    var overlay = document.getElementById("quizAnimationOverlay");
    var boardWrap = document.getElementById("qaBoardWrap");
    var frontImage = document.getElementById("qaFrontImage");
    var backImage = document.getElementById("qaBackImage");
    var stageMessage = document.getElementById("qaStageMessage");
    var continueBtn = document.getElementById("qaContinueBtn");
    var isProjection = new URLSearchParams(window.location.search).get("projection") === "1";
    var winnerHoldActive = false;
    var holdTimer = null;

    if (!overlay || !boardWrap) return;

    if (continueBtn) {
      continueBtn.addEventListener("click", function () {
        if (typeof window.continueToNextStage === "function") {
          window.continueToNextStage();
        }
      });
    }

    function resolveImage(roundNo) {
      var n = Number(roundNo);
      if (!Number.isFinite(n)) n = 1;
      n = Math.max(1, Math.min(5, Math.floor(n)));
      return "pictures/" + n + ".png";
    }

    function hideStageMessage() {
      if (!stageMessage) return;
      stageMessage.classList.remove("show");
      stageMessage.classList.add("hidden");
    }

    function setPlayState(state) {
      boardWrap.style.animationPlayState = state;
      var front = boardWrap.querySelector('.qa-front img');
      var back = boardWrap.querySelector('.qa-back img');
      if (front) front.style.animationPlayState = state;
      if (back) back.style.animationPlayState = state;
    }

    function clearHoldTimer() {
      if (holdTimer) {
        clearTimeout(holdTimer);
        holdTimer = null;
      }
    }

    function startBoardAnimation(src, onDone, options) {
      options = options || {};
      var holdAtCenter = !!options.holdAtCenter;
      var continueFromHold = !!options.continueFromHold;

      if (continueFromHold) {
        winnerHoldActive = false;
        if (continueBtn) continueBtn.classList.add("hidden");
        setPlayState("running");
        return;
      }

      clearHoldTimer();

      if (frontImage) frontImage.src = src;
      if (backImage) backImage.src = src;
      winnerHoldActive = false;
      if (continueBtn) continueBtn.classList.add("hidden");
      hideStageMessage();

      boardWrap.style.display = "";
      boardWrap.classList.remove("run");
      overlay.classList.remove("hidden");

      void boardWrap.offsetWidth;
      boardWrap.classList.add("run");
      setPlayState("running");

      boardWrap.onanimationend = function () {
        clearHoldTimer();
        boardWrap.style.display = "none";
        winnerHoldActive = false;
        overlay.classList.add("hidden");
        if (typeof onDone === "function") onDone();
      };

      if (holdAtCenter) {
        winnerHoldActive = true;
        holdTimer = setTimeout(function () {
          if (!winnerHoldActive) return;
          setPlayState("paused");
          if (continueBtn) {
            continueBtn.classList.toggle("hidden", isProjection);
          }
        }, 2000);
      }
    }

    function runQuizAnimation(roundNo, onDone) {
      if (typeof roundNo === "function") {
        onDone = roundNo;
        roundNo = 1;
      }
      var src = resolveImage(roundNo);
      startBoardAnimation(src, onDone);
    }

    function runStageWinnerTransition(message, onDone, imageSrc, showMessage) {
      var finalImage = imageSrc || "pictures/druga.png";
      var shouldShowMessage = showMessage !== false;
      var holdUntilManualContinue = onDone === null;

      overlay.classList.remove("hidden");
      boardWrap.style.display = "none";

      if (shouldShowMessage && stageMessage) {
        stageMessage.textContent = message || "POBJEDNIK JE TIM";
        stageMessage.classList.remove("hidden");
        requestAnimationFrame(function () {
          stageMessage.classList.add("show");
        });
      } else {
        hideStageMessage();
      }

      if (holdUntilManualContinue) {
        winnerHoldActive = true;
        if (continueBtn) {
          continueBtn.classList.toggle("hidden", isProjection);
        }
        return;
      }

      winnerHoldActive = false;
      if (continueBtn) continueBtn.classList.add("hidden");

      setTimeout(function () {
        hideStageMessage();
        startBoardAnimation(finalImage, onDone);
      }, 1500);
    }

    function runSpecialImageTransition(imageSrc, onDone, options) {
      startBoardAnimation(imageSrc || "pictures/druga.png", onDone, options || {});
    }

    window.runQuizAnimation = runQuizAnimation;
    window.runStageWinnerTransition = runStageWinnerTransition;
    window.runSpecialImageTransition = runSpecialImageTransition;
    window.isWinnerHoldOverlayActive = function () { return winnerHoldActive; };

    window.dismissStageWinnerOverlay = function () {
      clearHoldTimer();
      winnerHoldActive = false;
      hideStageMessage();
      if (continueBtn) continueBtn.classList.add("hidden");
      boardWrap.style.display = "none";
      overlay.classList.add("hidden");
    };
  })();
</script>
<script src="questions.js"></script>
<script src="game.js"></script>
</body>
</html>






